/*! kranthi-neighbourhood-map-project 2016-02-02 */
function init(){model.initializeMap(),model.searchPlaces(),model.loadingComplete(!0)}var viewModel=function(){var a=this;a.loadingComplete=ko.observable(!1),a.error=ko.observable(!1),a.errorText=ko.observable(""),a.location={latitude:12.971599,longitude:77.594563},this.search=ko.observable(""),a.initializeMap=function(){if("object"!=typeof google||"object"!=typeof google.maps)return a.loadingComplete(!0),a.error(!0),void a.errorText("Google server is not available");var b=new google.maps.LatLng(a.location.latitude,a.location.longitude),c={zoom:14,center:b,disableDefaultUI:!0,disableDoubleClickZoom:!1};a.map=new google.maps.Map(document.querySelector("#map"),c),a.map.setZoom(12),a.mapCard=new google.maps.InfoWindow({maxWidth:200})},a.places=ko.observableArray([]),a.searchPlaces=function(){a.error()||(console.log("searching hotels..."),apis.foursquare.getPlacesIn(a.location,function(b){return null==b||b.length<=0?(a.error(!0),void a.errorText("FourSquare places API did not return results in expected format")):(b.forEach(function(a){a.photoPath=ko.observable(),a.photoVisible=ko.observable(!0),apis.foursquare.getPhotosOf(a,function(b){if(a.photos=b.items,a.photos.length<=0)a.photoPath("http://placehold.it/100/FFFFCC/ffffff&text="+a.name.toUpperCase()),a.photoVisible(!1);else{a.photoVisible(!0);var c=a.photos[0];a.photoPath(c.prefix+"100x100"+c.suffix)}})}),void a.places(b))},a.handleError))},a.filteredPlaces=ko.computed(function(){var b=a.search().toLowerCase();return b?ko.utils.arrayFilter(a.places(),function(a){return-1!==a.name.toLowerCase().indexOf(b)}):a.places()}),a.mapMarkers=ko.observableArray([]),a.setPlaceMarker=function(b){var c=a.filteredPlaces().indexOf(b);a.onSelectedPlaceClick(a.mapMarkers[c],b)},a.clearMapMarkers=function(){for(var b=0;b<a.mapMarkers.length;b++)a.mapMarkers[b].setMap(null);a.mapMarkers=[]},a.createMapMarkers=function(b){a.clearMapMarkers();for(var c=b,d=0,e=c.length;e>d;d++){var f={lat:c[d].location.lat,lng:c[d].location.lng},g=new google.maps.Marker({position:f,map:this.map,icon:"images/pin.png"});a.mapMarkers.push(g),a.mapMarkers[d].setMap(this.map),g.addListener("click",a.onMapMarkerClick(g,c[d]))}},a.createMapMarkers(a.places()),a.filteredPlaces.subscribe(function(){a.createMapMarkers(a.filteredPlaces())}),a.disableAllMarkers=function(){a.mapMarkers.forEach(function(a){a.setIcon("images/pin.png")})},a.createMapMarkerCard=function(b,c){a.mapCard.close(),a.disableAllMarkers(),a.mapCard.setContent(a.mapCardHtml(c)),a.mapCard.open(a.map,b),b.setIcon("images/pinlg.png")},a.onMapMarkerClick=function(b,c){return function(){a.createMapMarkerCard(b,c)}},a.onSelectedPlaceClick=function(b,c){a.createMapMarkerCard(b,c)},a.mapCardHtml=function(a){(null==a.location.city||"undefined"==a.location.city)&&(a.location.city="Bangalore"),(null==a.location.country||"undefined"==a.location.country)&&(a.location.country="India");var b="<div class='card'><div class='card-block'><h4 class='card-title'>"+a.name+"</h4><h6 class='card-subtitle text-muted'>"+a.categories[0].name+"</h6></div><img src='"+a.photoPath()+"' class='img-thumbnail'>";return b=b+"<div class='card-block'><p class='card-text text-justify'><b>Address:</b><span>"+a.location.formattedAddress[0]+"</span></p><p class='card-text text-justify'>",b=b+"<h4><span class='label label-info'>"+a.location.city+","+a.location.country+"</span></h4>",b=b+"<span>"+a.stats.checkinsCount+"</span><b> people visited</b></p></div></div>"},a.handleError=function(b){a.loadingComplete(!0),b&&(console.log(b),"object"==typeof b?a.errorText("Can not retrieve all the places. Please reload the page."):"string"==typeof b&&a.errorText(b)),a.error(!0)}},model=new viewModel;$(document).ready(function(){ko.applyBindings(model)});